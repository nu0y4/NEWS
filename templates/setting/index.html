<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人信息页面</title>
    <link rel="stylesheet" href="{{ url_for('static',filename='css/setting-set.css') }}">
    <script>
        window.onload = function() {
            var username = "{{ username }}";
            if (!username || username === 'None') {
                alert("未登录，请先登录！");
                window.location.href = "/login";
            }
        }
        // 显示上传头像的弹出框
        function openAvatarPopup() {
            document.getElementById('avatar-popup').style.display = 'block';
        }

        // 关闭上传头像的弹出框
        function closeAvatarPopup() {
            document.getElementById('avatar-popup').style.display = 'none';
        }

            // 预览上传的头像
        function previewAvatar(event) {
            const reader = new FileReader();
            reader.onload = function() {
                const output = document.getElementById('avatar-preview');
                output.src = reader.result;
                output.style.display = 'block';  // 确保图片显示
            };
            reader.readAsDataURL(event.target.files[0]);
        }

        // 模拟上传头像
        function uploadAvatar() {
            const formData = new FormData();
            const fileField = document.querySelector('input[type="file"]');

            if (fileField.files.length === 0) {
                alert('请选择一个文件上传');
                return;
            }

            formData.append('avatar', fileField.files[0]);

            fetch('/upload_avatar', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(result => {
                alert('头像上传成功！');
                closeAvatarPopup();
                location.reload();  // 重新加载页面以刷新头像
            })
            .catch(error => {
                console.error('上传失败:', error);
                alert('头像上传失败，请重试');
            });
        }
        function showContent(contentId) {
            // 隐藏所有卡片内容
            document.querySelectorAll('.card-content').forEach(function(element) {
                element.style.display = 'none';
            });
            // 显示点击的卡片内容
            document.getElementById(contentId).style.display = 'block';
        }
        function logout(){
            fetch('/logout');
            window.location.href="./";
        }
    </script>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="avatar" onclick="openAvatarPopup()">
                <img src="{{ avatar_url }}" alt="头像" id="current-avatar">
            </div>
            <ul>
                <li><a href="#" onclick="showContent('profile')">个人信息</a></li>
                <li><a href="#" onclick="showContent('settings')">推送设置</a></li>
                <li><a href="#" onclick="logout()">退出登录</a></li>
            </ul>
        </div>
        <div class="main-content">
            <div id="profile" class="card-content">
                <div class="card">这是个人信息页面内容</div>
            </div>
            <div id="settings" class="card-content" style="display: none;">
                <div class="card">这是推送设置页面内容</div>
            </div>
        </div>
    </div>
<!-- 弹出框（上传头像卡片） -->
    <div id="avatar-popup" class="popup" style="display: none;">
        <div class="popup-content">
            <span class="close" onclick="closeAvatarPopup()">&times;</span>
            <h2>更换头像</h2>
            <input type="file" accept="image/*" onchange="previewAvatar(event)">
            <p>
            <img id="avatar-preview" src="" alt="预览头像" style="display: block; margin: 20px 0;">
                </p>
            <button onclick="uploadAvatar()">上传头像</button>
        </div>
    </div>
</body>
</html>
